<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Trigonometría Master Pro</title>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Open+Sans:wght@400;600;700&display=swap');

        * { touch-action: manipulation; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background: #ffffff; margin: 0; padding: 20px; 
            font-family: 'Open Sans', sans-serif; display: flex; justify-content: center; color: #333;
        }

        .container { 
            width: 100%; max-width: 1100px; background: #F2F2F2; padding: 40px 20px; 
            border-radius: 50px; box-shadow: 0 20px 60px rgba(0,0,0,0.05); text-align: center;
        }

        .header { margin-bottom: 20px; }
        .header h1 { font-family: 'Playfair Display', serif; font-size: 32px; margin: 0; }
        .header p { font-family: 'Playfair Display', serif; font-size: 18px; color: #666; margin-top: 5px; font-weight: 700; }

        /* Selector de Funciones Activas */
        .function-manager {
            display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; margin-bottom: 20px;
        }
        .toggle-btn {
            padding: 6px 12px; border-radius: 15px; border: 1px solid #ddd; background: #fff;
            font-size: 11px; font-weight: 700; cursor: pointer; transition: 0.3s; color: #888;
        }
        .toggle-btn.active { background: #333; color: #fff; border-color: #333; }

        /* Barra de Navegación de Gráficas */
        .mode-selector {
            display: inline-flex; background: #eee; padding: 5px; border-radius: 30px; 
            margin-bottom: 25px; gap: 5px; border: 1px solid #ddd;
        }
        .pill {
            padding: 10px 18px; border-radius: 25px; cursor: pointer; font-size: 12px;
            font-weight: 700; transition: 0.3s; color: #888; text-transform: uppercase; border: 1px solid transparent;
        }
        .pill.active { border: 1px solid rgba(0,0,0,0.1); color: #fff; }
        .pill.active.sin { background: #FF2D55; }
        .pill.active.cos { background: #007AFF; }
        .pill.active.tan { background: #FF9500; }
        .pill.active.csc { background: #AF52DE; }
        .pill.active.sec { background: #5856D6; }
        .pill.active.cot { background: #5AC8FA; }

        .main-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; align-items: center; }
        @media (max-width: 900px) { .main-grid { grid-template-columns: 1fr; } }

        .canvas-card {
            background: white; border-radius: 35px; padding: 25px; position: relative;
            border: 1px solid #ddd; display: flex; flex-direction: column; align-items: center;
        }
        canvas { max-width: 100%; height: auto; z-index: 1; cursor: crosshair; }

        .data-panel {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px; margin-top: 30px;
        }
        .data-item {
            background: white; padding: 18px; border-radius: 25px; border: 1px solid #ddd;
            display: flex; flex-direction: column; justify-content: center; min-height: 100px;
        }
        .data-label { font-size: 10px; font-weight: 700; color: #aaa; text-transform: uppercase; margin-bottom: 5px; }
        .data-value { font-size: 18px; font-weight: 700; color: #000; }
        .data-exact { font-size: 14px; color: #007AFF; font-weight: 600; margin-top: 4px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>Círculo Unitario</h1>
        <p>√(Raíz) Cuadrada²</p>
    </div>

    <div class="function-manager" id="manager">
        <button class="toggle-btn active" onclick="toggleVisibility('sin')">Seno</button>
        <button class="toggle-btn active" onclick="toggleVisibility('cos')">Coseno</button>
        <button class="toggle-btn active" onclick="toggleVisibility('tan')">Tangente</button>
        <button class="toggle-btn" onclick="toggleVisibility('csc')">Csc</button>
        <button class="toggle-btn" onclick="toggleVisibility('sec')">Sec</button>
        <button class="toggle-btn" onclick="toggleVisibility('cot')">Cot</button>
    </div>

    <div class="mode-selector" id="pills-container">
        </div>

    <div class="main-grid">
        <div class="canvas-card">
            <canvas id="circleCanvas" width="500" height="500"></canvas>
        </div>
        <div class="canvas-card">
            <canvas id="graphCanvas" width="500" height="500"></canvas>
        </div>
    </div>

    <div class="data-panel">
        <div class="data-item">
            <div class="data-label">Ángulo</div>
            <div class="data-value" id="val-angle">0.0°</div>
            <div class="data-exact" id="exact-angle">0 rad</div>
        </div>
        <div class="data-item">
            <div class="data-label">Seno</div>
            <div class="data-value" id="val-sin">0.000</div>
            <div class="data-exact" id="exact-sin">0</div>
        </div>
        <div class="data-item">
            <div class="data-label">Coseno</div>
            <div class="data-value" id="val-cos">1.000</div>
            <div class="data-exact" id="exact-cos">1</div>
        </div>
        <div class="data-item">
            <div class="data-label">Tangente</div>
            <div class="data-value" id="val-tan">0.000</div>
            <div class="data-exact" id="exact-tan">0</div>
        </div>
    </div>
</div>

<script>
    const circleCanvas = document.getElementById('circleCanvas');
    const circleCtx = circleCanvas.getContext('2d');
    const graphCanvas = document.getElementById('graphCanvas');
    const graphCtx = graphCanvas.getContext('2d');

    let currentAngle = 0; 
    let isDragging = false;
    let mode = 'sin';
    const activeFuncs = { sin: true, cos: true, tan: true, csc: false, sec: false, cot: false };

    // Valores Exactos (Mapeo de ángulos notables)
    const exactValues = {
        0:   { sin: '0', cos: '1', tan: '0' },
        30:  { sin: '1/2', cos: '√3/2', tan: '√3/3' },
        45:  { sin: '√2/2', cos: '√2/2', tan: '1' },
        60:  { sin: '√3/2', cos: '1/2', tan: '√3' },
        90:  { sin: '1', cos: '0', tan: '∞' },
        180: { sin: '0', cos: '-1', tan: '0' },
        270: { sin: '-1', cos: '0', tan: '∞' }
    };

    function toggleVisibility(f) {
        activeFuncs[f] = !activeFuncs[f];
        renderPills();
        if(!activeFuncs[mode]) mode = Object.keys(activeFuncs).find(k => activeFuncs[k]);
        updateManagerButtons();
        drawAll();
    }

    function renderPills() {
        const container = document.getElementById('pills-container');
        container.innerHTML = '';
        Object.keys(activeFuncs).forEach(f => {
            if(activeFuncs[f]) {
                const p = document.createElement('div');
                p.className = `pill ${f} ${mode === f ? 'active' : ''}`;
                p.innerText = f.toUpperCase();
                p.onclick = () => { mode = f; renderPills(); drawAll(); };
                container.appendChild(p);
            }
        });
    }

    function updateManagerButtons() {
        const btns = document.querySelectorAll('.toggle-btn');
        btns.forEach(b => {
            const func = b.innerText.toLowerCase().replace('seno', 'sin').replace('coseno', 'cos').replace('tangente', 'tan');
            b.className = `toggle-btn ${activeFuncs[func] ? 'active' : ''}`;
        });
    }

    function drawAll() {
        drawCircle();
        drawGraph();
        updateText();
    }

    function drawCircle() {
        const cx = 250, cy = 250, r = 180;
        circleCtx.clearRect(0, 0, 500, 500);

        // Guías
        circleCtx.strokeStyle = '#f0f0f0'; circleCtx.beginPath();
        circleCtx.moveTo(0, cy); circleCtx.lineTo(500, cy); circleCtx.moveTo(cx, 0); circleCtx.lineTo(cx, 500); circleCtx.stroke();
        
        circleCtx.strokeStyle = '#333'; circleCtx.lineWidth = 3;
        circleCtx.beginPath(); circleCtx.arc(cx, cy, r, 0, Math.PI * 2); circleCtx.stroke();

        const x = cx + r * Math.cos(currentAngle);
        const y = cy - r * Math.sin(currentAngle);

        // Seno y Coseno siempre visibles
        circleCtx.lineWidth = 5;
        circleCtx.strokeStyle = '#007AFF'; circleCtx.beginPath(); circleCtx.moveTo(cx, cy); circleCtx.lineTo(x, cy); circleCtx.stroke();
        circleCtx.strokeStyle = '#FF2D55'; circleCtx.beginPath(); circleCtx.moveTo(x, cy); circleCtx.lineTo(x, y); circleCtx.stroke();

        if (Math.abs(Math.cos(currentAngle)) > 0.02) {
            circleCtx.strokeStyle = '#FF9500'; circleCtx.beginPath(); 
            circleCtx.moveTo(cx + r, cy); circleCtx.lineTo(cx + r, cy - r * Math.tan(currentAngle)); circleCtx.stroke();
        }

        circleCtx.fillStyle = '#000'; circleCtx.beginPath(); circleCtx.arc(x, y, 10, 0, Math.PI * 2); circleCtx.fill();
    }

    function drawGraph() {
        const w = 500, h = 500, midY = h / 2, amp = 130;
        graphCtx.clearRect(0, 0, 500, 500);

        const colors = { sin:'#FF2D55', cos:'#007AFF', tan:'#FF9500', csc:'#AF52DE', sec:'#5856D6', cot:'#5AC8FA' };
        const funcs = { sin: Math.sin, cos: Math.cos, tan: Math.tan, csc: a => 1/Math.sin(a), sec: a => 1/Math.cos(a), cot: a => 1/Math.tan(a) };

        graphCtx.strokeStyle = '#eee'; graphCtx.beginPath();
        graphCtx.moveTo(50, 0); graphCtx.lineTo(50, h); graphCtx.moveTo(0, midY); graphCtx.lineTo(w, midY); graphCtx.stroke();

        graphCtx.strokeStyle = colors[mode]; graphCtx.lineWidth = 4;
        graphCtx.beginPath();
        for(let i = 0; i <= 400; i++) {
            const a = (i / 400) * Math.PI * 2;
            const v = funcs[mode](a);
            const py = midY - v * amp;
            if (Math.abs(v) > 10) { graphCtx.stroke(); graphCtx.beginPath(); }
            else { if(i === 0) graphCtx.moveTo(50+i, py); else graphCtx.lineTo(50+i, py); }
        }
        graphCtx.stroke();

        let norm = currentAngle % (Math.PI * 2); if(norm < 0) norm += Math.PI * 2;
        const mx = 50 + (norm / (Math.PI * 2)) * 400;
        const my = midY - funcs[mode](norm) * amp;
        if(Math.abs(funcs[mode](norm)) < 10) {
            graphCtx.fillStyle = colors[mode]; graphCtx.beginPath(); graphCtx.arc(mx, my, 8, 0, Math.PI * 2); graphCtx.fill();
        }
    }

    function updateText() {
        let n = currentAngle % (Math.PI * 2); if(n < 0) n += Math.PI * 2;
        let deg = Math.round(n * 180 / Math.PI);
        
        document.getElementById('val-angle').innerText = (n * 180 / Math.PI).toFixed(1) + '°';
        document.getElementById('exact-angle').innerText = (n / Math.PI).toFixed(2) + 'π rad';
        
        const s = Math.sin(n), c = Math.cos(n), t = Math.tan(n);
        document.getElementById('val-sin').innerText = s.toFixed(3);
        document.getElementById('val-cos').innerText = c.toFixed(3);
        document.getElementById('val-tan').innerText = Math.abs(t) > 20 ? '∞' : t.toFixed(3);

        // Mostrar exactos si hay snap
        const ex = exactValues[deg % 360] || exactValues[360 - (deg % 360)];
        document.getElementById('exact-sin').innerText = ex ? ex.sin : '';
        document.getElementById('exact-cos').innerText = ex ? ex.cos : '';
        document.getElementById('exact-tan').innerText = ex ? ex.tan : '';
    }

    function handle(e) {
        const rect = circleCanvas.getBoundingClientRect();
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const clientY = e.touches ? e.touches[0].clientY : e.clientY;
        let x = (clientX - rect.left) * (500 / rect.width) - 250;
        let y = 250 - (clientY - rect.top) * (500 / rect.height);
        
        let ang = Math.atan2(y, x);
        let deg = ang * 180 / Math.PI; if(deg < 0) deg += 360;

        // --- EFECTO IMÁN (Snap) ---
        const notables = [0, 30, 45, 60, 90, 120, 135, 150, 180, 210, 225, 240, 270, 300, 315, 330, 360];
        for(let n of notables) {
            if(Math.abs(deg - n) < 2.5) { // Sensibilidad de 2.5 grados
                ang = n * Math.PI / 180;
                if("vibrate" in navigator && currentAngle !== ang) navigator.vibrate(5);
                break;
            }
        }

        currentAngle = ang;
        drawAll();
    }

    circleCanvas.addEventListener('mousedown', () => isDragging = true);
    window.addEventListener('mouseup', () => isDragging = false);
    window.addEventListener('mousemove', (e) => isDragging && handle(e));
    circleCanvas.addEventListener('touchstart', (e) => { isDragging = true; handle(e); });
    circleCanvas.addEventListener('touchmove', (e) => { isDragging && handle(e); e.preventDefault(); }, {passive: false});

    renderPills();
    drawAll();
</script>
</body>
</html>
